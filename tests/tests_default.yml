# SPDX-License-Identifier: MIT
---
- name: Ensure that the role runs with default parameters
  hosts: all
  gather_facts: false
  # Do not do anything in this stest, otherwise fails with not enough storage
  vars:
    hpc_manage_storage: false
    hpc_install_nvidia_driver: false
    hpc_install_cuda_driver: false
    hpc_install_cuda_toolkit: false
    hpc_install_hpc_nvidia_nccl: false
    hpc_install_nvidia_fabric_manager: false
    hpc_install_nvidia_rdma: false
    hpc_install_openmpi: false
  tasks:
    - name: Run test in a block to clean up in always
      block:
        - name: Run the role
          include_role:
            name: linux-system-roles.hpc
      always:
        - name: Cleanup
          include_tasks: tasks/cleanup.yml
