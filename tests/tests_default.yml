# SPDX-License-Identifier: MIT
---
- name: Ensure that the role runs with default parameters
  hosts: all
  gather_facts: false
  # Do not do anything in this test, otherwise fails with not enough storage
  vars:
    hpc_manage_storage: false
    hpc_install_nvidia_driver: false
    hpc_install_cuda_driver: false
    hpc_install_cuda_toolkit: false
    hpc_install_hpc_nvidia_nccl: false
    hpc_install_nvidia_fabric_manager: false
    hpc_install_rdma: false
    hpc_install_system_openmpi: false
    hpc_build_openmpi_w_nvidia_gpu_support: false
    hpc_enable_eus_repo: false
    hpc_install_moneo: false
    hpc_install_nvidia_container_toolkit: false
    hpc_install_docker: "{{ hpc_install_nvidia_container_toolkit }}"
    hpc_install_azurehpc_health_checks: "{{ hpc_install_nvidia_container_toolkit }}"
    hpc_install_diagnostics: false
  tasks:
    - name: Skip unsupported architectures
      include_tasks: tasks/skip_unsupported_archs.yml

    - name: Run test in a block to clean up in always
      block:
        - name: Run the role
          include_role:
            name: linux-system-roles.hpc
      always:
        - name: Cleanup
          include_tasks: tasks/cleanup.yml
