# SPDX-License-Identifier: MIT
---
- name: Verify if role configures a custom storage properly
  hosts: all
  gather_facts: true
  vars:
    # Toolkit is about 6GB, let's skip it to save bandwidth
    hpc_install_cuda_toolkit: false
  tasks:
    - name: Run test in a block to clean up in always
      block:
        - name: End if not running on Azure
          meta: end_play
          when: ansible_system_vendor != "Microsoft Corporation"

        - name: Run the role
          include_role:
            name: linux-system-roles.hpc
      always:
        - name: Clean up after the role invocation
          include_tasks: tasks/cleanup.yml
